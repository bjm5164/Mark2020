function [filling_fraction,n_pos = filling_fraction(pre_neuron,post_neuron)

% Compute a filling fraction for two neurons.  Default settings are to
% compare the filling fraction between the presynaptic axon and
% postsynaptic dendrite. 



min_strahler = 1; 
sn = strahler_number( post_neuron );
post_neuron.Strahler_Number = sn;
%%
% Find the arbors that fit the strahler threshold that are part of the
% dendrite 
input_neurite = find(find(sn<=min_strahler) & post_neuron.input_density > 2);
post_xyz = post_neuron.Skeleton_Coords(input_neurite,:);

% Next get the index of the presynaptic sites on the axon of the pre-neuron
presyn_node_ids = arrayfun(@(x) pre_neuron.skeleton_data.tree2ind(pre_neuron.Outputs.treenodeID(x)), 1:length(pre_neuron.Outputs.treenodeID));
pre_xyz = pre_neuron.Skeleton_Coords(intersect(presyn_node_ids,pre_neuron.skeleton_data.axon),:);


distance_range = 2000;
clear nprox and nfill and ff
for i = 1:length(distance_range)
    D = min( pdist2(post_xyz,pre_xyz), [], 1 );
    Du = D < (distance_range(i));

    nprox(i) = sum( Du );
    nfill(i) = length(intersect( post_neuron.Inputs.conid, pre_neuron.Outputs.conid( Du ) ) );
    ff(i) = nfill(i)/nprox(i);
    if ff(i) == inf
        ff(i) = -1;
    elseif isnan(ff(i)) == 1
        ff(i) = -1;
    end
end
% figure; hold on
% plot(distance_range(1:end)./1000,ff(1:end),'Marker','o','Color','b','MarkerSize',15,'LineWidth',3)
% set(gcf,'Color','w')
% set(gca,'FontSize',18)
% xlabel('Potential Synapse Radius (µm)')
% ylabel('Filling Fraction')
end
